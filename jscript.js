const translations = {
  sr: {
    brand: {
      name: 'TravelWave',
      tagline: 'VaÅ¡ vodiÄ kroz nezaboravna putovanja'
    },
    nav: {
      home: 'PoÄetna',
      arrangements: 'AranÅ¾mani',
      europe: 'Evropa',
      summer: 'Leto 2025',
      winter: 'Zima 2025',
      gallery: 'Galerija',
      account: 'Moj nalog',
      about: 'O nama'
    },
    footer: {
      copy: 'Copyright 2025, Mihajlo ÄuroviÄ‡, Matija LekoviÄ‡, Odsek za softversko inÅ¾enjerstvo, ElektrotehniÄki fakultet Univerziteta u Beogradu'
    },
    pageTitles: {
      home: 'TravelWave | PoÄetna',
      europe: 'TravelWave | Evropa',
      summer: 'TravelWave | Leto 2025',
      winter: 'TravelWave | Zima 2025',
      gallery: 'TravelWave | Galerija',
      account: 'TravelWave | Moj nalog',
      about: 'TravelWave | O nama'
    },
    home: {
      hero: {
        title: 'Otkrijte svoju sledeÄ‡u destinaciju sa TravelWave agencijom',
        subtitle: 'Specijalizovani smo za aranÅ¾mane Å¡irom sveta uz punu podrÅ¡ku naÅ¡eg tima i proverene partnere.',
        ctaSummer: 'Pogledaj letnje aranÅ¾mane',
        ctaAccount: 'Prijavi se ili registruj nalog'
      },
      news: {
        title: 'Aktuelno u agenciji',
        item1: {
          title: 'Nova ponuda za porodiÄno letovanje u Halkidikiju',
          copy: 'Popusti do 15% za rezervacije do kraja maja, sa ukljuÄenim prevozom i deÄijim animacionim programom.'
        },
        item2: {
          title: 'Upoznajte naÅ¡eg novog turistiÄkog vodiÄa Marka',
          copy: 'Marko donosi iskustvo sa viÅ¡e od 120 realizovanih tura Å¡irom Evrope.'
        },
        item3: {
          title: 'Ekskluzivne city-break ponude za jesen 2025.',
          copy: 'RezerviÅ¡ite ranije i obezbedite direktan let, hotelski prevoz i obilazak uz lokalnog vodiÄa.'
        }
      },
      featured: {
        title: 'Top izbor za naredni mesec',
        card1: {
          title: 'Letovanje u GrÄkoj',
          copy: 'Sedam noÄ‡enja u luksuznom hotelu na Sitoniji, polupansion i avio-prevoz ukljuÄeni u cenu.',
          price: 'Cena: 499 â‚¬'
        },
        card2: {
          title: 'All inclusive Turska',
          copy: 'Deset noÄ‡enja u hotelu sa pet zvezdica u Alanji, kompletna all inclusive usluga i transfer od/do aerodroma.',
          price: 'Cena: 799 â‚¬'
        },
        card3: {
          title: 'Egipat â€“ Hurgada',
          copy: 'Sedam noÄ‡enja u hotelu sa privatnom plaÅ¾om, polupansion i fakultativni izleti.',
          price: 'Cena: 599 â‚¬'
        }
      },
      rated: {
        title: 'ðŸ† Najbolje ocenjeni aranÅ¾mani',
        card1: {
          title: 'Italija â€“ Rim',
          rating: 'Ocena: 4.7',
          review: 'â€žPredivan aranÅ¾man, vodiÄi su bili fantastiÄni!â€'
        },
        card2: {
          title: 'Crna Gora â€“ Budva',
          rating: 'Ocena: 4.5',
          review: 'â€žOdliÄan smeÅ¡taj i prelepa plaÅ¾a, sigurno se vraÄ‡am.â€'
        },
        card3: {
          title: 'Francuska â€“ Pariz',
          rating: 'Ocena: 5.0',
          review: 'â€žRomantiÄno iskustvo, hotel je bio na par minuta od Ajfelovog tornja!â€'
        }
      }
    },
    gallery: {
      title: 'Foto i video galerija',
      videoTitle: 'Video zapisi sa putovanja',
      video1: {
        caption: 'Santorini iz vazduha â€“ pogledajte kako izgleda najpopularnije ostrvo u GrÄkoj.'
      },
      video2: {
        caption: 'Zimska avantura na Alpima â€“ skijanje, spa i nezaboravne staze.'
      },
      photoTitle: 'Fotografije naÅ¡ih aranÅ¾mana'
    },
    arrangements: {
      searchPlaceholder: 'PretraÅ¾i aranÅ¾man po nazivu...',
      sortAsc: 'Sortiraj A-Z',
      sortDesc: 'Sortiraj Z-A',
      reserve: 'RezerviÅ¡i'
    },
    europe: {
      title: 'Evropske destinacije',
      subtitle: 'PaÅ¾ljivo biramo gradove i ture koje kombinuju kulturu, gastronomiju i jedinstvene doÅ¾ivljaje.',
      badge: 'City-break i viÅ¡ednevni aranÅ¾mani',
      prague: {
        title: 'Prag',
        copy: 'Tri noÄ‡enja u centru Praga, doruÄak ukljuÄen i licencirani vodiÄ na srpskom jeziku.',
        price: 'Cena: 299 â‚¬'
      },
      vienna: {
        title: 'BeÄ',
        copy: 'Dva noÄ‡enja, obilazak znamenitosti i autobuski prevoz iz Beograda uz lokalnog vodiÄa.',
        price: 'Cena: 249 â‚¬'
      },
      budapest: {
        title: 'BudimpeÅ¡ta',
        copy: 'Vikend aranÅ¾man sa krstarenjem Dunavom i hotelom sa Äetiri zvezdice u centru grada.',
        price: 'Cena: 199 â‚¬'
      }
    },
    summer: {
      title: 'Letnji aranÅ¾mani 2025',
      subtitle: 'Prepustite se suncu, toplom moru i avanturama koje smo pripremili za predstojeÄ‡u sezonu.',
      badge: 'All inclusive ponude i apartmani',
      budva: {
        title: 'Budva',
        copy: 'Sedam noÄ‡enja u hotelu sa tri zvezdice, polupansion i organizovan prevoz autobusom.',
        price: 'Cena: 399 â‚¬'
      },
      halkidiki: {
        title: 'Halkidiki',
        copy: 'Deset noÄ‡enja u apartmanskom smeÅ¡taju, sopstveni prevoz i popust za iznamljivanje Äamca.',
        price: 'Cena: 299 â‚¬'
      },
      hurghada: {
        title: 'Hurgada',
        copy: 'All inclusive aranÅ¾man, sedam noÄ‡enja i direktan let iz Beograda sa ukljuÄenim transferom.',
        price: 'Cena: 699 â‚¬'
      }
    },
    winter: {
      title: 'Zimski aranÅ¾mani 2025',
      subtitle: 'Ski pass, wellness i avanture u snegu â€“ paÅ¾ljivo kreirani paketi za ljubitelje zime.',
      badge: 'Planine i termalni centri',
      kopaonik: {
        title: 'Kopaonik',
        copy: 'Pet noÄ‡enja u planinskom hotelu sa spa centrom i ski pass-om ukljuÄenim u cenu.',
        price: 'Cena: 499 â‚¬'
      },
      zlatibor: {
        title: 'Zlatibor',
        copy: 'ÄŒetiri noÄ‡enja u apartmanskom smeÅ¡taju sa wellness centrom i panoramskom Å¾iÄarom.',
        price: 'Cena: 299 â‚¬'
      },
      tara: {
        title: 'Tara',
        copy: 'Å est noÄ‡enja sa autobuskim prevozom iz Beograda i organizovanim zimskim aktivnostima.',
        price: 'Cena: 199 â‚¬'
      }
    },
    account: {
      title: 'Moje rezervacije',
      subtitle: 'Ovde pregledate, potvrÄ‘ujete i otkazujete aranÅ¾mane koje ste saÄuvali.',
      clearAll: 'ObriÅ¡i sve rezervacije',
      clearConfirm: 'Da li ste sigurni da Å¾elite da obriÅ¡ete sve rezervacije?',
      empty: 'Trenutno nemate rezervisanih aranÅ¾mana.',
      priceLabel: 'Cena:',
      cancel: 'OtkaÅ¾i rezervaciju'
    },
    about: {
      title: 'Upoznajte TravelWave tim',
      subtitle: 'ViÅ¡e od jedne decenije kreiramo putovanja po meri â€“ od avanturistiÄkih tura do luksuznih odmora.',
      mission: {
        title: 'NaÅ¡a misija',
        copy: 'Verujemo da je svako putovanje prilika da se nauÄi neÅ¡to novo. Zato svaki aranÅ¾man gradimo oko autentiÄnih iskustava i lokalnih partnera.'
      },
      values: {
        title: 'NaÅ¡e vrednosti',
        copy: 'Transparentnost, odgovorno putovanje i sigurnost putnika su temelji naÅ¡eg svakodnevnog rada.'
      },
      awards: {
        title: 'Nagrade',
        item1: 'Najbolja agencija jugoistoÄne Evrope 2021.',
        item2: 'Priznanje za kvalitet usluge 2022.',
        item3: 'Top izbor putnika 2023.'
      },
      team: {
        title: 'NaÅ¡ tim',
        copy: 'Sastavljeni smo od licenciranih turistiÄkih vodiÄa, struÄnjaka za destinacije i savetnika koji su obiÅ¡li preko 60 zemalja. Svaki Älan tima poseduje sertifikate za pruÅ¾anje prve pomoÄ‡i i specijalizovane obuke za rad sa grupama.'
      },
      contact: {
        title: 'Kontakt',
        phoneLabel: 'Telefon:',
        emailLabel: 'E-poÅ¡ta:',
        officeLabel: 'Radno vreme:',
        officeHours: 'Radnim danima 09-18h, subotom 10-14h.'
      },
      reasons: {
        title: 'ZaÅ¡to izabrati TravelWave?',
        item1: '24/7 podrÅ¡ka putnicima i lokalni asistenti na destinaciji.',
        item2: 'Fleksibilne opcije plaÄ‡anja i moguÄ‡nost rate bez kamate.',
        item3: 'Ekskluzivni popusti zahvaljujuÄ‡i partnerstvu sa 150 hotela.'
      }
    }
  },
  en: {
    brand: {
      name: 'TravelWave',
      tagline: 'Your guide to unforgettable journeys'
    },
    nav: {
      home: 'Home',
      arrangements: 'Packages',
      europe: 'Europe',
      summer: 'Summer 2025',
      winter: 'Winter 2025',
      gallery: 'Gallery',
      account: 'My account',
      about: 'About us'
    },
    footer: {
      copy: 'Copyright 2025, Mihajlo ÄuroviÄ‡, Matija LekoviÄ‡, Department of Software Engineering, School of Electrical Engineering, University of Belgrade'
    },
    pageTitles: {
      home: 'TravelWave | Home',
      europe: 'TravelWave | Europe',
      summer: 'TravelWave | Summer 2025',
      winter: 'TravelWave | Winter 2025',
      gallery: 'TravelWave | Gallery',
      account: 'TravelWave | My Account',
      about: 'TravelWave | About Us'
    },
    home: {
      hero: {
        title: 'Discover your next destination with TravelWave',
        subtitle: 'We specialize in worldwide packages backed by our dedicated team and trusted partners.',
        ctaSummer: 'Browse summer packages',
        ctaAccount: 'Sign in or create an account'
      },
      news: {
        title: 'Agency highlights',
        item1: {
          title: 'New family holiday offer in Halkidiki',
          copy: 'Up to 15% early booking discount until the end of May, including transport and a kidsâ€™ animation program.'
        },
        item2: {
          title: 'Meet Marko, our newest tour guide',
          copy: 'Marko joins us with experience from more than 120 guided tours across Europe.'
        },
        item3: {
          title: 'Exclusive city-break deals for autumn 2025',
          copy: 'Book early to secure direct flights, hotel transfers and sightseeing with a local guide.'
        }
      },
      featured: {
        title: 'Top picks for next month',
        card1: {
          title: 'Summer escape to Greece',
          copy: 'Seven nights at a luxury hotel in Sithonia with half-board service and flights included.',
          price: 'Price: â‚¬499'
        },
        card2: {
          title: 'All inclusive Turkey',
          copy: 'Ten nights at a five-star hotel in Alanya, premium all inclusive service and airport transfers.',
          price: 'Price: â‚¬799'
        },
        card3: {
          title: 'Egypt â€“ Hurghada',
          copy: 'Seven nights at a private beach hotel, half-board and optional excursions.',
          price: 'Price: â‚¬599'
        }
      },
      rated: {
        title: 'ðŸ† Top-rated packages',
        card1: {
          title: 'Italy â€“ Rome',
          rating: 'Rating: 4.7',
          review: 'â€œWonderful tour, the guides were fantastic!â€'
        },
        card2: {
          title: 'Montenegro â€“ Budva',
          rating: 'Rating: 4.5',
          review: 'â€œGreat accommodation and beautiful beachesâ€”we will be back.â€'
        },
        card3: {
          title: 'France â€“ Paris',
          rating: 'Rating: 5.0',
          review: 'â€œA romantic experience, the hotel was minutes from the Eiffel Tower!â€'
        }
      }
    },
    gallery: {
      title: 'Photo and video gallery',
      videoTitle: 'Travel video highlights',
      video1: {
        caption: 'Santorini from above â€“ experience Greeceâ€™s most iconic island.'
      },
      video2: {
        caption: 'Winter thrills in the Alps â€“ skiing, spa breaks and unforgettable slopes.'
      },
      photoTitle: 'Photos from our packages'
    },
    arrangements: {
      searchPlaceholder: 'Search packages by name...',
      sortAsc: 'Sort A-Z',
      sortDesc: 'Sort Z-A',
      reserve: 'Reserve'
    },
    europe: {
      title: 'European destinations',
      subtitle: 'We curate cities and tours that blend culture, gastronomy and unique experiences.',
      badge: 'City-breaks and multi-day tours',
      prague: {
        title: 'Prague',
        copy: 'Three nights in central Prague with breakfast and a licensed Serbian-speaking guide.',
        price: 'Price: â‚¬299'
      },
      vienna: {
        title: 'Vienna',
        copy: 'Two nights, guided sightseeing and coach transport from Belgrade with a local guide.',
        price: 'Price: â‚¬249'
      },
      budapest: {
        title: 'Budapest',
        copy: 'Weekend break with a Danube cruise and four-star hotel in the city centre.',
        price: 'Price: â‚¬199'
      }
    },
    summer: {
      title: 'Summer packages 2025',
      subtitle: 'Enjoy the sun, warm seas and adventures we prepared for the upcoming season.',
      badge: 'All inclusive deals and apartments',
      budva: {
        title: 'Budva',
        copy: 'Seven nights at a three-star hotel, half-board service and organised coach transport.',
        price: 'Price: â‚¬399'
      },
      halkidiki: {
        title: 'Halkidiki',
        copy: 'Ten nights in apartment accommodation, self-drive and a discount on boat rental.',
        price: 'Price: â‚¬299'
      },
      hurghada: {
        title: 'Hurghada',
        copy: 'All inclusive stay, seven nights and direct flights from Belgrade with transfers.',
        price: 'Price: â‚¬699'
      }
    },
    winter: {
      title: 'Winter packages 2025',
      subtitle: 'Skipasses, wellness and snowy adventures â€“ tailor-made packages for winter lovers.',
      badge: 'Mountain resorts and thermal spas',
      kopaonik: {
        title: 'Kopaonik',
        copy: 'Five nights at a mountain hotel with spa access and skipass included in the price.',
        price: 'Price: â‚¬499'
      },
      zlatibor: {
        title: 'Zlatibor',
        copy: 'Four nights in apartment accommodation with wellness centre and panoramic cable car.',
        price: 'Price: â‚¬299'
      },
      tara: {
        title: 'Tara',
        copy: 'Six nights with coach transport from Belgrade and organised winter activities.',
        price: 'Price: â‚¬199'
      }
    },
    account: {
      title: 'My reservations',
      subtitle: 'Review, confirm and cancel the packages you have saved.',
      clearAll: 'Delete all reservations',
      clearConfirm: 'Are you sure you want to delete all reservations?',
      empty: 'You do not have any reservations yet.',
      priceLabel: 'Price:',
      cancel: 'Cancel reservation'
    },
    about: {
      title: 'Meet the TravelWave team',
      subtitle: 'For over a decade we have crafted tailor-made tripsâ€”from adventure tours to luxury escapes.',
      mission: {
        title: 'Our mission',
        copy: 'We believe every journey is a chance to learn something new, so we build each package around authentic experiences and local partners.'
      },
      values: {
        title: 'Our values',
        copy: 'Transparency, responsible travel and passenger safety are the foundations of our daily work.'
      },
      awards: {
        title: 'Awards',
        item1: 'Best agency in South-Eastern Europe 2021.',
        item2: 'Service quality award 2022.',
        item3: 'Travellersâ€™ top choice 2023.'
      },
      team: {
        title: 'Our team',
        copy: 'We are a group of licensed tour guides, destination experts and advisors who have visited more than 60 countries. Every team member is certified in first aid and trained to work with groups.'
      },
      contact: {
        title: 'Contact',
        phoneLabel: 'Phone:',
        emailLabel: 'Email:',
        officeLabel: 'Office hours:',
        officeHours: 'Monday to Friday 9amâ€“6pm, Saturday 10amâ€“2pm.'
      },
      reasons: {
        title: 'Why choose TravelWave?',
        item1: '24/7 traveller support and local assistants at each destination.',
        item2: 'Flexible payment plans with interest-free instalments.',
        item3: 'Exclusive discounts through partnerships with 150 hotels.'
      }
    }
  }
};

let currentLanguage = 'sr';

function translateKey(key, lang = currentLanguage) {
  const result = key.split('.').reduce((acc, part) => (acc && acc[part] !== undefined ? acc[part] : undefined), translations[lang]);
  if (result !== undefined) {
    return result;
  }
  if (lang !== 'sr') {
    return key.split('.').reduce((acc, part) => (acc && acc[part] !== undefined ? acc[part] : undefined), translations.sr);
  }
  return undefined;
}

function applyTranslations(lang) {
  document.querySelectorAll('[data-i18n-key]').forEach(element => {
    const key = element.getAttribute('data-i18n-key');
    if (!key) return;
    const translation = translateKey(key, lang);
    if (translation === undefined) return;
    const attr = element.getAttribute('data-i18n-attr');
    if (attr) {
      element.setAttribute(attr, translation);
    } else {
      element.textContent = translation;
    }
  });
}

function updateDocumentTitle(lang) {
  const pageKey = document.body.dataset.page || 'home';
  const title = translateKey(`pageTitles.${pageKey}`, lang);
  if (title) {
    document.title = title;
  }
}

function syncLanguageToggle(lang) {
  document.querySelectorAll('.lang-btn').forEach(button => {
    const isActive = button.dataset.lang === lang;
    button.classList.toggle('active', isActive);
  });
}

function highlightNavigation() {
  const pageKey = document.body.dataset.page;
  if (!pageKey) return;
  document.querySelectorAll('[data-page-target]').forEach(link => {
    const isCurrent = link.dataset.pageTarget === pageKey;
    link.classList.toggle('curr', isCurrent);
  });
}

function setLanguage(lang, persist = true) {
  if (!translations[lang]) {
    lang = 'sr';
  }
  currentLanguage = lang;
  if (persist) {
    localStorage.setItem('siteLang', lang);
  }
  document.documentElement.setAttribute('lang', lang === 'sr' ? 'sr' : 'en');
  document.body.dataset.currentLang = lang;
  applyTranslations(lang);
  updateDocumentTitle(lang);
  syncLanguageToggle(lang);
  highlightNavigation();
  if (document.body.dataset.page === 'account') {
    prikaziRezervacije();
  }
}

function initLanguage() {
  const stored = localStorage.getItem('siteLang');
  const initialLang = stored && translations[stored] ? stored : 'sr';
  setLanguage(initialLang, false);
}

function sortCards(order) {
  const container = document.getElementById('destinacije-cards');
  if (!container) return;
  const cards = Array.from(container.getElementsByClassName('destinacija-card'));
  const locale = currentLanguage === 'sr' ? 'sr' : 'en';
  cards.sort((a, b) => {
    const nameA = a.querySelector('.card-title').textContent.trim().toLowerCase();
    const nameB = b.querySelector('.card-title').textContent.trim().toLowerCase();
    const comparison = nameA.localeCompare(nameB, locale);
    return order === 'asc' ? comparison : -comparison;
  });
  cards.forEach(card => container.appendChild(card));
}

function filterCards() {
  const input = document.getElementById('pretraga');
  const container = document.getElementById('destinacije-cards');
  if (!input || !container) return;
  const query = input.value.toLowerCase();
  container.querySelectorAll('.destinacija-card').forEach(card => {
    const title = card.querySelector('.card-title').textContent.toLowerCase();
    card.style.display = title.includes(query) ? '' : 'none';
  });
}

function prikaziRezervacije() {
  const listContainer = document.getElementById('rezervacije-lista');
  const emptyState = document.getElementById('nema-rezervacija');
  if (!listContainer || !emptyState) return;

  const reservations = JSON.parse(localStorage.getItem('rezervacije') || '[]');
  listContainer.innerHTML = '';

  if (reservations.length === 0) {
    emptyState.style.display = 'block';
    const clearButton = document.getElementById('clear-reservations');
    if (clearButton) {
      clearButton.setAttribute('disabled', 'disabled');
    }
    return;
  }

  emptyState.style.display = 'none';
  const clearButton = document.getElementById('clear-reservations');
  if (clearButton) {
    clearButton.removeAttribute('disabled');
  }
  const priceLabel = translateKey('account.priceLabel') || 'Cena:';
  const cancelLabel = translateKey('account.cancel') || 'OtkaÅ¾i rezervaciju';

  reservations.forEach((reservation, index) => {
    const name =
      typeof reservation.naziv === 'object'
        ? reservation.naziv[currentLanguage] || reservation.naziv.sr || Object.values(reservation.naziv)[0]
        : reservation.naziv;
    const description =
      typeof reservation.opis === 'object'
        ? reservation.opis[currentLanguage] || reservation.opis.sr || Object.values(reservation.opis)[0]
        : reservation.opis;
    const price = reservation.cena || '';

    const column = document.createElement('div');
    column.className = 'col-md-6 col-lg-4';
    column.innerHTML = `
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">${name}</h5>
          <p class="card-text flex-grow-1">${description}</p>
          <p class="price fw-bold">${priceLabel} ${price}</p>
          <button class="btn btn-danger btn-sm mt-3" data-reservation-index="${index}">${cancelLabel}</button>
        </div>
      </div>
    `;
    listContainer.appendChild(column);
  });

  listContainer.querySelectorAll('button[data-reservation-index]').forEach(button => {
    button.addEventListener('click', event => {
      const idx = parseInt(event.currentTarget.getAttribute('data-reservation-index'), 10);
      otkaziRezervaciju(idx);
    });
  });
}

function otkaziRezervaciju(index) {
  const reservations = JSON.parse(localStorage.getItem('rezervacije') || '[]');
  reservations.splice(index, 1);
  localStorage.setItem('rezervacije', JSON.stringify(reservations));
  prikaziRezervacije();
}

function clearReservations() {
  const message = translateKey('account.clearConfirm') || 'Da li ste sigurni?';
  if (!window.confirm(message)) {
    return;
  }
  localStorage.removeItem('rezervacije');
  prikaziRezervacije();
}

function rezervisiAranzman(srNaziv, enNaziv, srOpis, enOpis, cena) {
  const reservations = JSON.parse(localStorage.getItem('rezervacije') || '[]');
  reservations.push({
    naziv: { sr: srNaziv, en: enNaziv },
    opis: { sr: srOpis, en: enOpis },
    cena
  });
  localStorage.setItem('rezervacije', JSON.stringify(reservations));
  window.location.href = 'mojnalog.html';
}

document.addEventListener('DOMContentLoaded', () => {
  initLanguage();

  document.querySelectorAll('.lang-btn').forEach(button => {
    button.addEventListener('click', () => {
      const { lang } = button.dataset;
      if (lang) {
        setLanguage(lang);
      }
    });
  });

  if (document.body.dataset.page === 'account') {
    prikaziRezervacije();
    const clearButton = document.getElementById('clear-reservations');
    if (clearButton) {
      clearButton.addEventListener('click', clearReservations);
    }
  }
});
